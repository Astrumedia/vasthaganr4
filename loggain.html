<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Logga in — Västhaga Nr4</title>
<style>
:root{
  --bg:#f7f9fc;
  --card:#ffffff;
  --accent:#f09a0f;
  --accent-dark:#d27c0c;
  --muted:#6b7280;
  --maxw:900px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg);
  color:#0b1220;
  display:flex;
  flex-direction:column;
  min-height:100vh;
}

/* --- Header (vit som på admin.html) --- */
header{
  position:fixed;
  top:0; left:0; width:100%;
  padding:22px 32px;
  background:#fff;
  transition:box-shadow .25s;
  display:flex; align-items:center; justify-content:space-between;
  z-index:100;
  box-shadow:0 4px 12px rgba(0,0,0,0.05);
}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:44px;height:44px;border-radius:8px;background:var(--accent);display:flex;align-items:center;justify-content:center}
.logo img{width:100%;height:100%;object-fit:cover;border-radius:8px}
nav ul{list-style:none;margin:0;padding:0;display:flex;gap:8px;align-items:center}
nav a{padding:8px 12px;border-radius:8px;text-decoration:none;color:inherit;transition:all .18s;white-space:nowrap}
nav a:hover{background:var(--accent);color:#fff}
.dropdown{position:relative}
.dropdown-content{position:absolute;top:36px;left:0;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.08);padding:8px;display:none;min-width:180px;z-index:80}
.dropdown.show .dropdown-content{display:block}
.hamburger{display:none;font-size:1.6rem;cursor:pointer;color:var(--accent)}
@media(max-width:768px){
  .hamburger{display:block}
  nav ul{flex-direction:column;position:fixed;top:0;right:0;width:260px;height:100%;background:#fff;padding-top:72px;padding-left:16px;transform:translateX(100%);transition:transform .28s;box-shadow:-6px 0 20px rgba(0,0,0,0.08);z-index:120;align-items:flex-start}
  nav ul.show{transform:translateX(0)}
  nav ul li{width:100%;margin-bottom:12px}
  nav ul li a{width:100%;text-align:left;padding-left:12px}
  .dropdown-content{position:static;box-shadow:none;padding-left:12px;display:none}
  .dropdown.active .dropdown-content{display:block}
}

/* --- Innehåll --- */
main{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:120px 16px 80px;
}

/* --- Kort / panel --- */
.card{
  background:var(--card);
  padding:40px;
  border-radius:18px;
  box-shadow:0 12px 30px rgba(11,18,32,0.08);
  max-width:400px;
  width:100%;
  animation:fadeIn .4s ease;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

h1{text-align:center;margin-bottom:20px;color:var(--accent);}
p.lead{text-align:center;color:var(--muted);margin:10px 0 20px;}
label{font-weight:600;color:#333;display:block;margin-bottom:6px;}
input{
  padding:12px;
  border-radius:10px;
  border:1px solid #e6eef2;
  font-size:1rem;
  width:100%;
  margin-bottom:16px;
}
.btn{
  padding:12px 16px;
  border:none;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
  transition:all .25s ease;
}
.btn-primary{background:var(--accent);color:#fff;box-shadow:0 4px 10px rgba(240,154,15,0.4);}
.btn-primary:hover{background:var(--accent-dark);transform:translateY(-1px);}
.btn-outline{background:#fff;border:1px solid var(--accent);color:var(--accent);}
.btn-outline:hover{background:var(--accent);color:#fff;}
.bottom-actions{margin-top:16px;display:flex;justify-content:center;gap:10px;}
.link-btn{background:none;border:none;color:var(--accent);cursor:pointer;text-decoration:underline;font-weight:600;}
.link-btn:hover{color:var(--accent-dark);}
#loginMsg{margin-top:10px;text-align:center;font-weight:600;}
.error{color:#b91c1c;}
.success{color:green;}

/* --- Overlays --- */
.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,0.45);
  display:none;align-items:center;justify-content:center;
  z-index:200;
}
.overlay.show{display:flex;animation:fadeIn .25s;}
.panel{
  background:#fff;padding:28px;border-radius:14px;
  box-shadow:0 18px 40px rgba(0,0,0,0.2);
  max-width:400px;width:90%;
}
.panel h2{text-align:center;color:var(--accent);margin-bottom:12px;}
.footer-note{text-align:center;margin-top:18px;color:var(--muted);font-size:0.9rem}
</style>
</head>
<body>

<header id="siteHeader">
  <div class="brand">
    <a href="index.html" class="logo"><img src="logga.png" alt="Logga"></a>
    <a href="index.html" style="text-decoration:none;color:inherit;display:flex;flex-direction:column">
      <div style="font-weight:700;font-size:1.3rem">Västhaga Nr4</div>
      <div style="font-size:0.95rem;color:var(--muted)">Bostadsrättsförening</div>
    </a>
  </div>

  <nav>
    <div class="hamburger" id="hamburger">☰</div>
    <ul id="mainNav">
      <li><a href="index.html">Hem</a></li>
      <li class="dropdown" id="omDropdown">
        <a href="om.html">Om föreningen ▾</a>
        <div class="dropdown-content">
          <a href="om.html">Om oss</a>
          <a href="stadgar.html">Stadgar</a>
        </div>
      </li>
      <li class="restricted"><a href="styrelsen.html">Styrelsen</a></li>
      <li class="restricted"><a href="pagaendeplaner.html">Planeringsprojekt</a></li>
      <li class="restricted"><a href="felanmalan.html">Felanmälan</a></li>
      <li id="loginNav"><a href="loggain.html">Logga in</a></li>
      <li id="kontoNav" style="display:none;"><a href="konto.html">Konto</a></li>
      <li id="adminNav" style="display:none;"><a href="admin.html">Admin</a></li>
    </ul>
  </nav>
</header>

<main>
  <div class="card">
    <h1>Logga in</h1>

    <form id="loginForm">
      <label for="email">E-post</label>
      <input id="email" type="email" placeholder="din@epost.se" required>
      <label for="password">Lösenord</label>
      <input id="password" type="password" placeholder="Lösenord" required>

      <button class="btn btn-primary" type="submit" style="width:100%;">Logga in</button>

      <p class="lead">Logga in med din e-postadress och lösenord.</p>

      <div id="loginMsg"></div>
    </form>

    <div class="footer-note">
      Saknar du konto? Skapa ett nytt eller återställ lösenordet här nedan.
    </div>

    <div class="bottom-actions">
      <button id="createBtn" class="link-btn">Skapa konto</button>
      <button id="forgotBtn" class="link-btn">Glömt lösenord</button>
    </div>
  </div>
</main>

<!-- Overlays -->
<div class="overlay" id="signupOverlay">
  <div class="panel">
    <h2>Skapa konto</h2>
    <form id="signupForm">
      <label for="suName">Namn</label>
      <input id="suName" type="text" required placeholder="Förnamn Efternamn">
      <label for="suEmail">E-post</label>
      <input id="suEmail" type="email" required placeholder="din@epost.se">
      <label for="suPassword">Lösenord</label>
      <input id="suPassword" type="password" required>
      <label for="suPassConfirm">Bekräfta lösenord</label>
      <input id="suPassConfirm" type="password" required>
      <div id="signupError" class="error" style="display:none;margin-top:8px;"></div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
        <button type="button" id="signupCancel" class="btn btn-outline">Avbryt</button>
        <button type="submit" class="btn btn-primary">Skapa konto</button>
      </div>
    </form>
  </div>
</div>

<div class="overlay" id="resetOverlay">
  <div class="panel">
    <h2>Återställ lösenord</h2>
    <form id="resetForm">
      <label for="resetEmail">E-post</label>
      <input id="resetEmail" type="email" required>
      <div id="resetMsg" style="margin-top:6px;"></div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
        <button type="button" id="resetCancel" class="btn btn-outline">Avbryt</button>
        <button type="submit" class="btn btn-primary">Skicka länk</button>
      </div>
    </form>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBQHkQql41jioZ1LbF8MdxBFoKmUifqWlo",
  authDomain: "vasthaganr4.firebaseapp.com",
  projectId: "vasthaganr4",
  storageBucket: "vasthaganr4.firebasestorage.app",
  messagingSenderId: "547846391741",
  appId: "1:547846391741:web:048eb47b28d1027539f4d4"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* --- Inloggning --- */
const loginForm=document.getElementById('loginForm');
const loginMsg=document.getElementById('loginMsg');
const emailEl=document.getElementById('email');
const passEl=document.getElementById('password');

loginForm.addEventListener('submit',async e=>{
  e.preventDefault();
  loginMsg.textContent='';
  try{
    const cred=await signInWithEmailAndPassword(auth,emailEl.value,passEl.value);
    const uid=cred.user.uid;
    const docSnap=await getDoc(doc(db,'users',uid));
    const userData=docSnap.exists()?docSnap.data():{role:'user',email:cred.user.email,name:cred.user.email.split('@')[0]};
    localStorage.setItem('currentUser',JSON.stringify({uid,...userData}));
    loginMsg.textContent='Inloggad!'; loginMsg.className='success';
    setTimeout(()=>window.location.href='index.html',800);
  }catch(err){loginMsg.textContent='Fel e-post eller lösenord.';loginMsg.className='error';}
});

/* --- Skapa konto --- */
const signupOverlay=document.getElementById('signupOverlay');
const signupForm=document.getElementById('signupForm');
const suName=document.getElementById('suName');
const suEmail=document.getElementById('suEmail');
const suPassword=document.getElementById('suPassword');
const suPassConfirm=document.getElementById('suPassConfirm');
const signupError=document.getElementById('signupError');

signupForm.addEventListener('submit',async e=>{
  e.preventDefault(); signupError.style.display='none';
  const name=suName.value.trim(), email=suEmail.value.trim().toLowerCase();
  const p1=suPassword.value, p2=suPassConfirm.value;
  if(p1!==p2){signupError.textContent='Lösenorden matchar inte.';signupError.style.display='block';return;}
  if(p1.length<8){signupError.textContent='Lösenordet måste vara minst 8 tecken.';signupError.style.display='block';return;}
  try{
    const cred=await createUserWithEmailAndPassword(auth,email,p1);
    const uid=cred.user.uid;
    const role=email==='uradmin@vasthaganr4.se'?'ordforande':'user';
    await setDoc(doc(db,'users',uid),{name,email,role,createdAt:serverTimestamp()});
    localStorage.setItem('currentUser',JSON.stringify({uid,name,email,role}));
    alert('Konto skapat!');
    window.location.href='index.html';
  }catch(err){signupError.textContent=err.message;signupError.style.display='block';}
});

/* --- Återställ lösenord --- */
const resetOverlay=document.getElementById('resetOverlay');
const resetForm=document.getElementById('resetForm');
const resetEmail=document.getElementById('resetEmail');
const resetMsg=document.getElementById('resetMsg');

resetForm.addEventListener('submit',async e=>{
  e.preventDefault();
  try{
    await sendPasswordResetEmail(auth,resetEmail.value.trim());
    resetMsg.textContent='Ett återställningsmail har skickats.';
  }catch{resetMsg.textContent='Kunde inte skicka återställningsmail.';}
});

/* --- Överlägg och meny --- */
function showOverlay(o){o.classList.add('show');}
function hideOverlay(o){o.classList.remove('show');}

document.getElementById('createBtn').onclick=()=>{signupForm.reset();showOverlay(signupOverlay)};
document.getElementById('forgotBtn').onclick=()=>{resetForm.reset();showOverlay(resetOverlay)};
document.getElementById('signupCancel').onclick=()=>hideOverlay(signupOverlay);
document.getElementById('resetCancel').onclick=()=>hideOverlay(resetOverlay);
document.querySelectorAll('.overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)hideOverlay(o)}));

const hamburger=document.getElementById('hamburger');
const mainNav=document.getElementById('mainNav');
hamburger.addEventListener('click',()=>{
  mainNav.classList.toggle('show');
  hamburger.textContent=mainNav.classList.contains('show')?'➤':'☰';
});

/* --- Visa/Dölj länkar --- */
const currentUser=JSON.parse(localStorage.getItem('currentUser')||'null');
const loginNav=document.getElementById('loginNav');
const kontoNav=document.getElementById('kontoNav');
const adminNav=document.getElementById('adminNav');

document.querySelectorAll('.restricted').forEach(li=>{
  li.style.display=currentUser?'block':'none';
});
if(currentUser){
  loginNav.style.display='none';
  kontoNav.style.display='block';
}else{
  kontoNav.style.display='none';
  loginNav.style.display='block';
}
if(currentUser && ['admin','ordforande'].includes(currentUser.role)){
  adminNav.style.display='block';
}else{
  adminNav.style.display='none';
}
</script>
</body>
</html>
