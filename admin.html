<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Adminpanel — Västhaga Nr4</title>
  <style>
    :root {
      --bg:#f7f9fc;
      --card:#ffffff;
      --accent:#f09a0f;
      --muted:#6b7280;
      --maxw:1200px;
    }
    *{box-sizing:border-box}
    body{
      font-family:Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      margin:0;
      background:var(--bg);
      color:#0b1220;
    }
    .container{
      max-width:var(--maxw);
      margin:120px auto;
      padding:16px;
    }
    header{
      position:fixed;top:0;left:0;width:100%;
      background:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.08);
      padding:22px 32px;
      display:flex;align-items:center;justify-content:space-between;
      z-index:10;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:8px;background:var(--accent);display:flex;align-items:center;justify-content:center;}
    .logo img{width:100%;height:100%;object-fit:cover;border-radius:8px;}
    nav ul{list-style:none;padding:0;margin:0;display:flex;gap:4px;align-items:center;}
    nav a{padding:8px 12px;border-radius:8px;text-decoration:none;color:inherit;transition:all 0.2s;white-space:nowrap;}
    nav a:hover{background:var(--accent);color:#fff;}
    .dropdown{position:relative;}
    .dropdown-content{
      position:absolute;top:36px;left:0;background:#fff;display:none;
      border-radius:8px;padding:8px;min-width:180px;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);z-index:10;
    }
    .dropdown:hover .dropdown-content{display:block;}
    .dropdown-content a{color:var(--accent);display:block;padding:6px 10px;border-radius:6px;}
    .dropdown-content a:hover{background:var(--accent);color:#fff;}
    .hamburger{display:none;font-size:1.8rem;cursor:pointer;user-select:none;color:var(--accent);}
    @media(max-width:768px){
      .hamburger{display:block;}
      nav ul{flex-direction:column;position:fixed;top:0;right:0;width:220px;height:100%;
        background:#fff;padding-top:80px;padding-left:20px;
        transform:translateX(100%);transition:transform 0.3s ease;
        box-shadow:-4px 0 12px rgba(0,0,0,0.08);
        z-index:20;text-align:left;align-items:flex-start;}
      nav ul.show{transform:translateX(0);}
      nav ul li{margin-bottom:12px;width:100%;}
      nav ul li a{width:100%;text-align:left;padding-left:16px;}
      .dropdown-content{position:static;box-shadow:none;padding-left:12px;}
    }

    h1{text-align:center;color:var(--accent);}
    .card{
      background:var(--card);
      padding:20px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(11,18,32,0.04);
      margin-bottom:24px;
    }
    .card h2{color:var(--accent);margin-top:0;}
    button{
      background:var(--accent);
      color:#fff;
      border:none;
      border-radius:8px;
      padding:8px 14px;
      cursor:pointer;
      transition:.2s;
    }
    button:hover{background:#d27c0c;}
    .user-item{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid #eee;}
    .muted{color:var(--muted);}
    footer{text-align:center;color:var(--muted);margin:40px 0 20px;font-size:.9rem;}
  </style>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, collection, getDocs, updateDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBQHkQql41jioZ1LbF8MdxBFoKmUifqWlo",
      authDomain: "vasthaganr4.firebaseapp.com",
      projectId: "vasthaganr4",
      storageBucket: "vasthaganr4.firebasestorage.app",
      messagingSenderId: "547846391741",
      appId: "1:547846391741:web:048eb47b28d1027539f4d4"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const userListDiv = document.getElementById("userList");
    const adminListDiv = document.getElementById("adminList");
    const logsDiv = document.getElementById("logs");
    const roleInfo = document.getElementById("roleInfo");

    function renderUserList(users, currentUser){
      userListDiv.innerHTML="";
      users.forEach(u=>{
        const div=document.createElement('div');
        div.className="user-item";
        div.innerHTML=`<span>${u.email} — <span class="muted">${u.role}</span></span>`;
        if(currentUser.role==="ordforande" && u.role!=="ordforande"){
          const btn=document.createElement('button');
          btn.textContent=(u.role==="admin")?"Ta bort admin":"Gör till admin";
          btn.onclick=async()=>{
            await updateDoc(doc(db,"users",u.id),{role:u.role==="admin"?"user":"admin"});
            alert("Roll uppdaterad!");
          };
          div.appendChild(btn);
        }
        userListDiv.appendChild(div);
      });
    }

    function renderAdmins(users){
      adminListDiv.innerHTML="";
      users.filter(u=>u.role==="admin"||u.role==="ordforande").forEach(u=>{
        const div=document.createElement('div');
        div.className="user-item";
        div.innerHTML=`<span>${u.email}</span>`;
        adminListDiv.appendChild(div);
      });
    }

    onAuthStateChanged(auth, async(user)=>{
      if(!user){
        alert("Du måste vara inloggad för att se adminpanelen.");
        window.location.href="loggain.html";
        return;
      }

      const snap=await getDocs(collection(db,"users"));
      const users=snap.docs.map(d=>({id:d.id,...d.data()}));
      const current=users.find(u=>u.id===user.uid);
      if(!current){alert("Ingen användardata hittades.");return;}

      roleInfo.textContent=`Inloggad som: ${user.email} (${current.role})`;

      // Real-time updates
      onSnapshot(collection(db,"users"),snap=>{
        const updated=snap.docs.map(d=>({id:d.id,...d.data()}));
        renderUserList(updated,current);
        renderAdmins(updated);
      });

      if(current.role!=="ordforande" && current.role!=="admin"){
        alert("Du har inte tillgång till denna sida.");
        window.location.href="index.html";
      }
    });

    document.getElementById("logoutBtn").addEventListener("click",()=>{
      signOut(auth).then(()=>window.location.href="index.html");
    });
  </script>
</head>
<body>

<header>
  <div class="brand">
    <a href="index.html" class="logo"><img src="logga.png" alt="Logga"></a>
    <div style="display:flex;flex-direction:column;">
      <div style="font-weight:700;font-size:1.5rem;">Västhaga Nr4</div>
      <div class="muted">Bostadsrättsförening</div>
    </div>
  </div>
  <nav>
    <div class="hamburger" id="hamburger">☰</div>
    <ul id="mainNav">
      <li><a href="index.html">Hem</a></li>
      <li class="dropdown">
        <a href="#">Om föreningen ▾</a>
        <div class="dropdown-content">
          <a href="om.html">Om oss</a>
          <a href="stadgar.html">Stadgar</a>
        </div>
      </li>
      <li class="dropdown">
        <a href="#">Styrelsen ▾</a>
        <div class="dropdown-content">
          <a href="styrelsen.html">Styrelsen</a>
          <a href="styrelseninformerar.html">Styrelsen informerar</a>
        </div>
      </li>
      <li class="dropdown">
        <a href="#">Planeringsprojekt ▾</a>
        <div class="dropdown-content">
          <a href="pagaendeplaner.html">Pågående planer</a>
          <a href="utfordaplaner.html">Utförda planer</a>
        </div>
      </li>
      <li><a href="felanmalan.html">Felanmälan</a></li>
      <li><a href="konto.html">Konto</a></li>
      <li><a href="admin.html" style="font-weight:600;color:var(--accent);">Admin</a></li>
    </ul>
  </nav>
</header>

<div class="container">
  <h1>Adminpanel</h1>
  <p id="roleInfo" style="text-align:center;font-weight:600;"></p>

  <div class="card">
    <h2>Aktuella admins</h2>
    <div id="adminList"></div>
  </div>

  <div class="card" id="userCard">
    <h2>Användare</h2>
    <div id="userList"></div>
  </div>

  <div class="card">
    <h2>Senaste ändringar</h2>
    <div id="logs"><p class="muted">Här kommer loggar visas senare...</p></div>
  </div>

  <div style="text-align:center;margin-top:16px;">
    <button id="logoutBtn">Logga ut</button>
  </div>
</div>

<footer>&copy; Västhaga Nr4 — Bostadsrättsförening</footer>

<script>
  const mainNav=document.getElementById("mainNav");
  const hamburger=document.getElementById("hamburger");
  hamburger.addEventListener("click",()=>{
    mainNav.classList.toggle("show");
    hamburger.textContent=mainNav.classList.contains("show")?"➤":"☰";
  });
</script>

</body>
</html>
